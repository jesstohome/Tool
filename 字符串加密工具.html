<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æœ¬åœ°å­—ç¬¦ä¸²åŠ å¯† / è§£å¯†å·¥å…·ï¼ˆç¦»çº¿ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 24px;
    }
    .container {
      max-width: 820px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    h1 {
      margin-top: 0;
      font-size: 22px;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 16px;
    }
    textarea, input {
      width: 100%;
      box-sizing: border-box;
      margin-top: 8px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    .row {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    button {
      flex: 1;
      padding: 12px;
      font-size: 15px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    .encrypt { background: #4f46e5; color: #fff; }
    .decrypt { background: #059669; color: #fff; }
    .copy { background: #6b7280; color: #fff; }
    .tip {
      margin-top: 16px;
      font-size: 13px;
      color: #555;
      line-height: 1.6;
      background: #f9fafb;
      padding: 12px;
      border-radius: 8px;
    }
    .footer {
      margin-top: 20px;
      font-size: 12px;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” æœ¬åœ°å­—ç¬¦ä¸²åŠ å¯† / è§£å¯†å·¥å…·</h1>

    <label>æ˜æ–‡ / å¯†æ–‡</label>
    <textarea id="text" placeholder="è¾“å…¥éœ€è¦åŠ å¯†çš„æ˜æ–‡ï¼Œæˆ–éœ€è¦è§£å¯†çš„å¯†æ–‡"></textarea>

    <label>å¯†ç ï¼ˆè¯·ç‰¢è®°ï¼Œæ— æ³•æ‰¾å›ï¼‰</label>
    <input id="password" type="password" placeholder="è¾“å…¥ä½ çš„åŠ å¯† / è§£å¯†å¯†ç " />

    <div class="row">
      <button class="encrypt" onclick="encryptHandler()">åŠ  å¯†</button>
      <button class="decrypt" onclick="decryptHandler()">è§£ å¯†</button>
      <button class="copy" onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
    </div>

    <label>ç»“æœ</label>
    <textarea id="result" placeholder="è¿™é‡Œä¼šæ˜¾ç¤ºåŠ å¯†æˆ–è§£å¯†åçš„ç»“æœ"></textarea>

    <div class="tip">
      <strong>è¯´æ˜ï¼š</strong><br />
      â€¢ æœ¬å·¥å…·å®Œå…¨åœ¨æœ¬åœ°æµè§ˆå™¨è¿è¡Œï¼Œä¸è”ç½‘ã€ä¸ä¸Šä¼ æ•°æ®<br />
      â€¢ ä½¿ç”¨ AES-256-GCM + PBKDF2ï¼ˆ100000 æ¬¡ï¼‰<br />
      â€¢ å¯†æ–‡ä¸­å·²åŒ…å« salt å’Œ ivï¼Œåªéœ€ä¿å­˜ä¸€æ•´ä¸²å¯†æ–‡å³å¯<br />
      â€¢ å¯†ç é”™è¯¯å°†æ— æ³•è§£å¯†
    </div>

    <div class="footer">ç¦»çº¿ HTML æ–‡ä»¶ï¼Œå¯é•¿æœŸä¿å­˜ä½¿ç”¨</div>
  </div>

<script>
const encoder = new TextEncoder();
const decoder = new TextDecoder();

async function deriveKey(password, salt, usage) {
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(password),
    "PBKDF2",
    false,
    ["deriveKey"]
  );

  return crypto.subtle.deriveKey(
    { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    false,
    usage
  );
}

async function encryptHandler() {
  const text = document.getElementById("text").value;
  const password = document.getElementById("password").value;
  if (!text || !password) return alert("è¯·è¾“å…¥æ˜æ–‡å’Œå¯†ç ");

  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await deriveKey(password, salt, ["encrypt"]);

  const encrypted = await crypto.subtle.encrypt(
    { name: "AES-GCM", iv },
    key,
    encoder.encode(text)
  );

  const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
  combined.set(salt, 0);
  combined.set(iv, 16);
  combined.set(new Uint8Array(encrypted), 28);

  document.getElementById("result").value = btoa(String.fromCharCode(...combined));
}

async function decryptHandler() {
  const base64 = document.getElementById("text").value;
  const password = document.getElementById("password").value;
  if (!base64 || !password) return alert("è¯·è¾“å…¥å¯†æ–‡å’Œå¯†ç ");

  try {
    const data = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
    const salt = data.slice(0, 16);
    const iv = data.slice(16, 28);
    const encrypted = data.slice(28);

    const key = await deriveKey(password, salt, ["decrypt"]);
    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv },
      key,
      encrypted
    );

    document.getElementById("result").value = decoder.decode(decrypted);
  } catch (e) {
    alert("è§£å¯†å¤±è´¥ï¼šå¯†ç é”™è¯¯æˆ–å¯†æ–‡æŸå");
  }
}

function copyResult() {
  const result = document.getElementById("result");
  if (!result.value) return;
  result.select();
  document.execCommand("copy");
  alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
}
</script>
</body>
</html>
